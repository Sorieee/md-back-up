# 1. DDD入门

​	领域驱动设计（DDD）作为一种软件开发方法，它可以帮助我们设计高质量的软件模型。在正确实现的情况下，我们通过DDD完成的设计恰恰就是软件的工作方式。本书便是帮助你如何正确实现DDD的。

本章学习路线图

* 了解DDD可以为你的项目和团队带来哪些好处
* 如何确定你的项目是否适合采用DDD
* 了解DDD的常见替代方案和它们将导致问题的原因
* 学习DDD的基础
* 学习如何向你的管理层、领域专家和技术成员推销DDD
* 了解使用DDD时所面临的挑战
* 看看一个正在学习采用DDD的团队是如何工作的

## 我能DDD吗？

你是可以实施DDD的，如果你：

* 有开发卓越软件的激情和毅力
* 渴望学习和进步
* 有能力理解软件模式，并懂得如何应用这些模式
* 有发掘不同设计方法的能力和耐性
* 勇于改变现状
* 看重细节，希望亲自试验
* 希望编写更好的代码



​	DDD首先并不是关于技术的，而是关于讨论、聆听、理解、发现和业务价值的，而这些都是为了将知识集中起来。如果你了解公司的业务，那么你至少可以为DDD的通用语言（Ubiquitous Language）做出贡献。当然，你可能需要学习更多的业务知识。由于你对业务概念的理解，你已经开始走在DDD的康庄大道上了。

**将领域专家引入到团队是大有好处的。**

​	在实施DDD的过程中，你最好将那些不怎么使用技术语言的人加进自己的团队。就像你会向他们学习一样，他们也会向你学习。

​	可能你最希望看到的便是：领域专家同样得听你的。大家都是同一个团队的成员。领域专家不见得就知道所有的业务，他们也得学习。就像你会向他们学习一样，他们也会向你学习。你向领域专家提出的问题有可能暴露出他们不知道的地方。你将直接帮组团队更好地理解业务，甚至确定业务。

**但是，我们还没有领域专家**

​	领域专家并不是一个职位，他可以是精通业务的任何人。他们可能了解更多的关于业务领域的背景知识，他们可能是软件产品的设计者，甚至有可能是销售员。

**什么是领域模型？**

​	领域模型是关于某个特定业务领域的软件模型。通常，领域模型通过对象模型来实现，这些对象同时包含了数据和行为，并且表达了准确的业务含义。



不同角色的人都可以从DDD中获益，看看自己属于以下角色的哪一种：

* 新手，初级开发者：“我还年轻，有很多点子，对写代码充满了热情。但是我所在的那个项目简直让人崩溃，我才不想一毕业就被那些重复性的工作纠来缠去。这个项目的架构为什么如此复杂？这到底是怎么呢？我修改了一点代码，却破坏了更多的代码。有人知道这本来应该是什么样子吗？现在，我还得添加一些复杂的新特性。我在遗留代码之上添加了一个适配器来屏蔽那些难看的遗留代码，但是没有用。我相信除了整天写代码和调试外，还有更好的办法。于是有人向我介绍DDD，听说DDD是领域模型中的‘四人帮（Gang of Four）’，不错不错。”
* 中级开发者：“在过去的几个月中，我加入了一个新的项目，这次轮到我来做出改变了。那时，当我和高级开发人员在一起工作时，我发现我缺少对事物的洞察力。有时团队非常涣散，但是我又不知道其中的原因，我决定改变团队成员们的做事方式。我需要一种能够助我成功的软件开发技术。一个高级架构师向我推荐DDD，我打算了解了解。
* 高级开发者，架构师：“我曾在多个项目中都使用过DDD，不过目前所在项目还未使用。我喜欢DDD战术模式的威力，但是我还打算应用更多的DDD模式，比如战略设计等。在阅读[Evans]时，我发现通用语言的功能非常强大。我已经与团队成员和管理层讨论过采用DDD的事情了，但其中有些中高级开发者对DDD在项目中的前景并不看好，而管理层也不是那么热衷于DDD。我是最近才加入公司的，虽然我是团队带头人，但是整个团队似乎并不愿意被一些新奇玩意儿打断了开发进度。不管如何，我是不会放弃的。虽然其他开发者对DDD没有信心，但是我是能做到的。我决定将领域专家引入到团队中来，使他们跟技术人员一起工作。”

* 领域专家：“我已经在IT部门帮他们解决业务问题好长一段时间了，我希望开发者们能够更好地理解他们所做的事情。他们总是认为我们业务人员是愚蠢的。但是他们不知道的是，如果不是我们，他们早就丢了工作。开发者总会以一些奇怪的方式来讨论我们的软件，如果我说这是A，他们却说这是B，好像我们需要有本词典才能交流一样。如果我们试图纠正他们的错误叫法，他们就不愿意合作了。我们在这上面浪费了太多的时间。软件为什么不能像真正的业务专家所想象的那样工作呢？”你说对了。软件开发的最大问题之一便是业务人员和技术人员需要某种翻译才能交流。本章将对此做出讨论。你将看到，DDD将业务人员和技术人员放在同一个层面上。惊讶吧，你已经使一些开发者向你靠近了，多帮帮他们。
* 项目经理：“我们要交付软件，但结果并不总是让人舒心，有时开发时间拖得太长了。开发者在谈论到领域时总是各执一词，莫衷一是。我不确定我们是否需要另一种银弹般的技术或者方法。之前我们不是没有尝试过，但是每次都失败了，结果还是得回到原来的位置。我总是说，我们应该放弃幻想，准备战斗，但是团队成员并不这么认为。他们工作非常努力，我总觉得欠他们些什么，于是听听他们的意见吧。他们都是聪明之人，并且都希望做出些改变。对于我来说，如果我上面的管理层同意，我是完全允许开发者们花时间学习的。团队成员们希望有个集中化的业务知识体系，我想我可以以此说服我的老板。这样一来，我自己的工作也将变得简单，我还可以促进团队和业务专家之间的合作与互信。”

## 为什么我们需要DDD

* 使领域专家和开发者在一起工作，这样开发出来的软件能够准确地传达业务规则。当然，对于领域专家和开发者来说，这并不表示单单地包容对方，而是将他们组成一个密切协作的团队。
* “准确传达业务规则”的意思是说，此时的软件就像如果领域专家是编码人员时所开发出来的一样。
* 可以帮助业务人员自我提高。没有任何一个领域专家或者管理者敢说他对业务已经了如指掌了，业务知识也需要一个长期的学习过程。在DDD中，每个人都在学习，同时每个人又是知识的贡献者。
* 关键在于对知识的集中，因为这样可以确保软件知识并不只是掌握在少数人手中。
* 在领域专家、开发者和软件本身之间不存在“翻译”，意思是当大家都使用相同的语言进行交流时，每人都能听懂他人所说。
* 设计就是代码，代码就是设计。设计是关于软件如何工作的，最好的编码设计来自于多次试验，这得益于敏捷的发现过程。
* DDD同时提供了战略设计和战术设计两种方式。战略设计帮助我们理解哪些投入是最重要的；哪些既有软件资产是可以重新拿来使用的；哪些人应该被加到团队中？战术设计则帮助我们创建DDD模型中各个部件。

**难以捉摸的业务价值**

​	开发能够传递真正业务价值的软件和开发普通的软件是不同的。具有真正业务价值的软件能够很好地符合业务战略，并且可以将竞争优势融合到解决方案中。此时的软件并不是关于技术的，而是关于业务的。

**DDD如何帮助我们**

​	DDD作为一种软件开发方法，它主要关注以下三个方面：

1. DDD将领域专家和开发人员聚集到一起，这样所开发的软件能够反映出领域专家的思维模型。这并不意味这我们将精力都花在了对“真实世界”的建模上，而是交付最具业务价值的软件。有时在实用和理想之间存在冲突，根据它们的互异程度，在DDD中我们将选择实用性。
2. DDD关注业务战略。虽然说战略（Strategic）设计自然地包含了战术设计，但是战略设计关注更多的则是业务的战略方向。它帮助我们定义不同团队之间的组织关系，并在这些关系有可能导致项目失败的时候提供早期预警。DDD的战略设计用于清楚地界分不同的系统和业务关注点，这样可以保护每个业务层面的服务。更进一步，这将指引我们如何实现面向服务架构（serviceoriented architecture）或者业务驱动（business-driven architecture）架构。
3. 通过使用战术设计建模工具，DDD满足了软件真正的技术需求。这些战术设计工具使开发人员能够按照领域专家的思维模型开发软件。同时，所开发出来的软件是可测试的，能够尽量避免错误，能执行服务层面协议（Service-LevelAgreement，SLA），具有很好的伸缩性，并且允许分布式计算。DDD的最佳实践同时包含了高层的架构性实践和底层设计实践，关注业务规则和数据不变性，并且可以对业务规则起到保护作用。

**处理领域复杂性**

​	在使用DDD时，我们首先希望将它应用在最重要的业务场景下。对于那些可以轻易替换的软件来说，你是不会有所投入的。相反，值得你投入的是那些重要的、复杂的东西，因为这些东西将为你带来可观的回报。正因如此，我们将这样的模型命名为核心域（Core Domain，2），而那些相对次要的称为支撑子域（Supporting Subdomain，2）。那么现在，我们需要搞明白的是，“复杂”到底是什么意思？

**DDD的作用是简化，而不是复杂化**

​	在使用DDD时，我们应该采用最简单的方式对复杂领域进行建模，而不是使问题变得更加复杂。

​	不同的业务领域对于复杂的定义是不一样的。另外，不同的公司所面临的挑战不一样；成熟度不一样；软件开发能力也不一样。因此，与其去定义什么是复杂的，还不如定义什么是重要的。这时，你的团队和管理层应该做出决定：你们开发的软件系统是否值得做出DDD投入。

**DDD计分卡：**使用表1.1来决定你的项目是否值得做出DDD投入。如果你的项目情况在某行的描述范围之内，那么请在右边的列中记上相应的分数，最后将这些分数相加得到总分。如果得分为7分或者以上，那么，你应该考虑使用DDD了。

![](https://pic.imgdb.cn/item/627cc5890947543129e46226.jpg)

![](https://pic.imgdb.cn/item/627cc5a50947543129e4b7d3.jpg)

**贫血症和失忆症**

​	贫血症严重危害着人类健康，并且伴随有危险的副作用。当贫血领域对象（Anemic Domain Object）[Fowler，Anemic]被首次提出来时，它并不是一个博得赞美的词汇，它描述的是一个缺少内在行为的领域对象。奇怪的是，人们对于贫血领域对象的态度褒贬不一。问题在于，多数开发者认为这样的领域对象是正常的，他们并没有意识到这是一个严重的问题。

![](https://pic.imgdb.cn/item/627cc6250947543129e63a01.jpg)

**为什么会有贫血领域对象**

​	如果说贫血领域对象是由设计不当造成的，为什么还有如此多的人认为他们的领域对象是健康的呢？其中一个原因是：贫血领域对象反映了一种自然的过程式的编程风格，但我并不认为这是首要原因。软件业中有很多开发者都是学着示例代码做开发的，这并不是什么坏事，只要示例代码本身是好的。然而，通常情况是，示例代码只是用尽可能简单的方式来展示某个特定的概念或者API特性，而并不强调要遵循多好的设计原则。一些极度简化的示例代码总是包含了大量的getter和setter，于是这些getter和setter随着示例代码每天被程序员们原封不动地来回复制。

**我应该考虑在DDD中使用对象-关系映射（Object-Relational Mapping，ORM）吗？**

​	此外，多数的Web框架依然只支持JavaBean规范。如果你想将一个Java对象显示在网页上，该Java对象最好是支持JavaBean规范的。如果你想将HTML表单中的数据传到一个Java对象中，该Java对象也最好是支持JavaBean规范的。

**看看贫血对象都对你的模型做了些什么**

​	你可能会查看很多客户代码，然后比较代码历史，找出saveCustomer（）的来龙去脉。你会发现，没有人能够解释这个方法为什么会成为现在这个样子，也没有人知道究竟有多少客户代码在正确地使用saveCustomer（）方法。要自己去搞明白这里面的缘由，你得花上几个小时甚至几天的时间。

**等等！**

​	这时你可能在想，“我们的设计都是在白板上进行的啊。我们会绘制设计框图，只有大家都达成一致时，我们才开始编码实现。”

​	现在你可能有些担心，“我要如何才能做到更好的设计呢？”用不着担心，你会成功的，继续读下去。

## 如何DDD

​	让我们暂时撇开关于实现细节的讨论，现在来看看DDD最具威力的特性之一：通用语言。通用语言和限界上下文（Bounded Context，2）同时构成了DDD的两大支柱，并且它们是相辅相成的。

**上下文术语**

​	就现在来说，可以将限界上下文看成是整个应用程序之内的一个概念性边界。这个边界之内的每种领域术语、词组或句子——也即通用语言，都有确定的上下文含义。在边界之外，这些术语可能表示不同的意思。我们将在第2章中对限界上下文做深入探讨。

**通用语言**

​	通用语言是团队共享的语言。领域专家和开发者使用相同的通用语言进行交流。事实上，团队中每个人都使用相同的通用语言。不管你在团队中的角色如何，只要你是团队的一员，你都将使用通用语言。

​	通用语言是团队自己创建的公用语言，团队中同时包含领域专家和软件开发人员。

![](https://pic.imgdb.cn/item/627cc7f90947543129eb7fa0.jpg)

​	由于通用语言最初只来自于领域专家，分歧是难免的。然而，这正是创建最佳通用语言的自然过程。在这个过程中，团队成员通过讨论、参考资料、引用标准、查阅词典等对通用语言进行改进。有时我们发现，有些我们曾经认为能很好表达业务的词汇不再适用了，而另外的一些词汇具有更好的效果。

* 同时绘制物理模型图和概念模型图，并标以名字和行为。虽然这些图并不是正式的设计图，但它们却包含了软件建模的某些方面。即使你的团队在使用统一建模语言（Unified Modeling Language，UML ）来完成正式建模，也不要得意忘形，因为这样可能反而不利于团队的讨论，最终将阻碍通用语言的产生。
* 创建一个包含简单定义的术语表。将你能想到的术语都罗列出来，包括好的和不好的，并注明好与不好的原因。在你给术语下定义时，你在不经意间就会创造出一些可重用的词汇，因为此时你使用的是领域中的通用语言。
*  如果你不喜欢术语表，可以采用其他类型的文档，但记得将那些“不正式”的模型图也包含进去。同样，这里最终的目的也是发现通用语言中的术语和词组。
* 由于团队中有些人工作在术语表上，还有些人工作在文档上，此时你需要找到团队的其他人员来检查你的成果。分歧肯定是有的，你应该对此有所准备。

​	有了以上认识，我们便可以重新设计saveCustomer（）方法了。我们将修改Customer，使其能够反映出它应该支持的业务操作：

![](https://pic.imgdb.cn/item/627cc9750947543129eff69a.jpg)

​	当然，以上的Customer并不是一个完美的模型，然而在实施DDD时，对设计的反思正是我们所期望的。作为一个团队，我们可以自由地讨论什么样的模型才是最好的，在对通用语言达成了一致之后，才开始着手开发。然而，即便我们可以对通用语言进行一遍又一遍地提炼，此时上面的例子已经能够反映出一个Customer应该支持的业务操作了。

![](https://pic.imgdb.cn/item/627cca110947543129f1c53d.jpg)

​	因此，我们使用通用语言来捕捉特定核心业务领域中的概念和术语，它是一种团队模式。软件模型包含名词、形容词、动词和一些富有含义的语句等，团队成员便通过这些语言进行交流。软件实现和测试中也使用和团队语言一样的通用语言。

**是通用，不是万能**

​	我想，关于通用语言，有必要再做一点澄清。在理解通用语言时，我们必须牢牢记住以下几点：

*  这里的“通用”意思是“普遍的”，或者“到处都存在的”。通用语言在团队范围内使用，并且只表达一个单一的领域模型。
* “通用语言”并不表示全企业、全公司或者全球性的万能的领域语言。
* 限界上下文和通用语言间存在一对一的关系。
*  限界上下文是一个相对较小的概念，通常比我们起初想象的要小。限界上下文刚好能够容纳下一个独立的业务领域所使用的通用语言。
* 只有当团队工作在一个独立的限界上下文中时，通用语言才是“通用”的。
* 虽然我们只工作在一个限界上下文中，但是通常我们还需要和其他限界上下文打交道，这时可以通过上下文映射图（3）对这些限界上下文进行集成。每个限界上下文都有自己的通用语言，而有时语言间的术语可能有重叠的地方。
* 如果你试图将某个通用语言运用在整个企业范围之内，或者更大的、夸企业的范围内，你将失败。

## 使用DDD的业务价值

​	如果你的经验和我相当，你就应该知道软件开发者不应该只是热衷于技术，而是应该将眼界放得更宽。我认为不管使用什么技术，我们的目的都是提供业务价值。而如果我们采用的技术确实产生了业务价值，人们就没有理由拒绝我们在技术上的建议。

**业务价值最重要吗？**

​	让我们来看看DDD所带来的一些非常理想化的业务价值。记得将这些分享给你的管理层、领域专家和技术人员。我们可以将DDD的业务价值大致总结为以下几点：

1. 你获得了一个非常有用的领域模型
2. 你的业务得到了更准确的定义和理解
3. 领域专家可以为软件设计做出贡献
4. 更好的用户体验
5. 清晰的模型边界
6. 更好的企业架构
7. 敏捷、迭代式和持续建模
8. 使用战略和战术新工具

**1. 你获得了一个非常有用的领域模型**

​	DDD强调将精力花在对业务最有价值的东西上。我们并不过度建模，而是关注业务的核心域。有些模型是用来支撑核心域的，它们同样是重要的。但是，这些起支撑作用的模型在优先级上没有核心域高。

**2.你的业务得到了更准确的定义和理解**

​	业务人士能够更好地理解业务本身。我甚至听说通用语言曾经出现在某些公司的市场营销材料中。随着业务模型的不断改善，人们对业务的理解也将更加深刻。在团队讨论的过程中，一些业务细节被不断地暴露出来，这些细节有助于掌握业务价值。

**3.领域专家可以为软件设计做出贡献**

​	当人们对自己的核心业务有了更深的了解时，业务价值自然就出来了。领域专家并不总是同意某些概念和术语。有时，分歧源自于领域专家们在其他公司工作时所积累起来的经验，而有时分歧则源自于公司内部。不管如何，当领域专家们在一起工作时，他们最终将达成一致意见，这对于整个公司来说都是件好事。

**4.更好的用户体验**

​	用户体验可以更好地反映出领域模型的好坏。

​	如果软件留下太多的地方让用户自己去理解，用户往往需要经过培训才能做出操作决定。实际上，用户只是将他们所理解的转移到表单（form）中的数据而已。数据将被存储起来，如果用户不知道数据的用途，那么结果也将是错误的。

**5.清晰的模型边界**

​	我们并不鼓励技术团队将精力单纯地放在编码和算法上，而是期望他们能够面向业务。明确的目标产生高效的解决方案，而要达到这样的目的往往需要更好地理解项目的限界上下文。

**6.更好的企业架构**

​	一旦限界上下文得到了较好的理解和仔细的划分，那么团队的所有成员应该知道限界上下文间的集成是必要的。上下文之间的边界和关系是明晰的。当不同上下文的模型间存在依赖关系时，我们将使用上下文映射图来集成不同的限界上下文，而这又有助于我们全面地了解整个企业的架构。

**7.敏捷、迭代式和持续建模**

​	“设计”这个词可能并不能取悦业务管理层。然而，DDD并不是一个重量级的设计方法和开发过程。DDD并不是画模型图，而是将领域专家的思维模型转化成有用的业务模型。DDD不是创建一个真实世界的模型，而是模仿现实。

**8.使用战略和战术新工具**

​	限界上下文为团队创建了一个建模边界，成员在边界内部为特定的业务领域创建解决方案。在单个限界上下文中团队成员共享一套通用语言。不同的团队有时各自负责一个限界上下文，此时可以使用上下文映射图在战略层面上对限界上下文进行界分和集成。在某个建模边界内部，团队将使用战术建模工具：聚合（Aggregate，10）、实体（Entity，5）、值对象（Value Object，6）、领域服务（Domain Service，7）和领域事件（Domain Event，8）等。

## 实施DDD所面临的挑战

​	在实施DDD的过程中，挑战是不可避免的。那么，有人成功过吗？DDD都有哪些常见的挑战，我们又如何处理它们？我将讨论以下三点最常见的挑战：

* 为创建通用语言腾出时间和精力
* 持续地将领域专家引入项目
*  改变开发者对领域的思考方式



​	使用DDD最大的挑战之一便是：我们需要花费大量的时间和精力来思考业务领域，研究概念和术语，并且和领域专家交流，以发现、捕捉和改进通用语言。如果你想完全采用DDD来最大化业务价值，你需要做出很多努力，并且花费很多时间。事实就是这样的。

​	要将领域专家引入你的项目恐怕也不是一件易事。但是不管有多么困难，这是你必须做的。如果你连一个领域专家都找不到，那么你根本无法对一个领域有深入的理解。当你找到领域专家的时候，此时开发者应该表现出主动。开发者应该找领域专家交谈并仔细聆听，然后将你们的谈话转化成软件代码。

​	如果你所工作的领域和业务相去甚远，领域专家所了解的也只是一些边边角角，那么此时你应该将这种问题暴露出来。在我曾经工作的一个项目里，真正的领域专家很难找到，有时他们还会到处出差，我得等上好几周才能和他们开上一次会。在一些小型的公司里，领域专家通常是CEO或者副总裁，他们的事情太多了，这时你也别指望他们能做好你的领域专家。

**白板时间**

* 对于你目前正在工作的业务领域，思考一下模型中的通用术语和业务操作。
* 将术语写在白板上。
* 然后，将项目中所用到的短语也写下来。
* 与真正的领域专家交流一下，看看哪些词汇是可以改善的（记得带上咖啡哦）。

**为领域建模正名**

​	通常来说，战术建模比战略建模复杂。因此，如果你打算采用DDD的战术模式（聚合、领域服务、值对象和领域事件等）来建立领域模型的话，你需要更仔细的思考和更大的投入。那么，我们有什么理由依然要采用战术建模呢？我们又拿什么标准来衡量在DDD上的投入是值得的呢？

​	你可能已经在盘算，这将把你带到一个陌生的领地，你发现你得好好研究一下周边的情况。你的团队可能会学着既有的线路图，甚至开辟一条新路来决定自己的战略设计方案。你可能会仔细捉摸这片新的领地，然后试图使其为你所用。然而，不管你事先做了多少准备，这都将是一条荆棘丛生之路。

​	如果你发现你需要在战略的岩石上攀爬，那么你得找到一套合适的战术工具来辅助你。站在低处往上看，你有可能看到一些特别的挑战和危险地带。然而，如果不爬到那样的高度，你又是看不清楚的。你可能需要在坚硬的岩石上打孔插钉，但是也可以找到那些自然形成的裂缝。你可能还需要带上锁环以保证安全。你可以沿着一条路线顺直而上，也可以打点布阵、步步为营。有时随着岩石形状的走势，你可能需要往回撤，再重新设计路线。有人认为攀岩是种危险的运动，但是那些尝试过的人会告诉你，攀岩实际上比驾驶汽车和飞机还安全。攀岩者需要知道如何使用工具和运用好技能，并且能够根据岩石状况做出相应的反应。

​	如果说开发一个业务子域（Subdomain，2）就像攀岩一样困难，那么我们需要随身携带DDD的战术模式来武装自己。对于满足核心域标准的业务来说，我们不应该将战术模式拒之门外。半途而废的项目时有发生，而正确的战术模式可以帮助我们减少这种情况的发生。

​	这里是一些实际的指导意见，我会先讲高层次的，然后讲更具体的：

* 如果一个限界上下文被当成核心域来开发，那么从战略上来说，这个限界上下文对业务的成功是极其重要的。核心模型是不易理解的，需要不断地尝试和重构。通过持续改进，我们可以延长它的效用生命，这样的做法显然是值得的。当然，这个限界上下文不见得始终是你的核心域。即便如此，如果它是复杂的，创新性的，并且需要在不断的变化中持续存在很长时间，我们还是建议在该限界上下文中使用战术模式。这里，我们假设你的核心域是值得配置最好的开发者的。
* 一个领域，对于消费方来说有可能成为通用子域（Generic Subdomain，2）或者支撑子域，但是却有可能成为你自己的核心域。我们并不站在最终消费方的角度来评价一个领域。如果你正在开发的限界上下文是你主要的业务，那么它便是你的核心域，而不管消费方是如何看待的。此时，一定记得使用战术模式。
* 如果你正开发一个支撑子域，但是由于种种原因，该支撑子域不能从第三方的通用子域直接获得，那么此时战术模式将帮上你大忙。在这种情况下，你需要考虑团队成员的技能水平，还有模型是否具有创新性。如果此时的模型增加了特定的业务价值，而且不只是拥有技术上的绚丽，那么该模型就可以认为是创新性的。如果团队有能力实施战术设计，这个支撑子域又是创新性的，并且将持续存在很长时间，那么此时便是采用战术设计的大好时机。尽管如此，这并不能使该子域称为核心域，因为在业务人士眼中，这样的领域只是支撑性的。



​	对于有丰富DDD经验的开发者来说，上面的指导建议可能就不够了。如果你的团队经验丰富，其中的开发者又确信战术建模是种好的选择，那么此时他们的意见可能就更值得相信。诚实的开发者，不管经验丰富与否，都会在特定的情况下明确地指出领域建模是否为最佳的选择。

​	业务领域的类型本身并不自动地决定应该选择哪种开发方式。你的团队应该考虑一些重要的问题，然后做出决定。请考虑以下因素，这些因素和上面提到的高层次指导是有对应关系的。

* 团队是否有领域专家，如果有，你如何围绕领域专家组织自己的团队？
* 虽然就目前来说，你的业务领域是简单的，但它将来会变得复杂吗？对于复杂的系统来说，使用事务脚本是存在风险的。当领域变得复杂时，是否有可能将系统重构到富含行为的领域模型？
* DDD的战术模式是否可以简化与其他限界上下文的集成，不管是第三方的还是定制开发的？
* 使用事务脚本是否的确可以减少代码量？（经验表明，不管是对于哪种开发方式，事务脚本都不能减少代码量。这可能是由于在项目计划阶段，领域复杂性并没得到正确的认识所致。因此，我们需要在领域复杂性上下足功夫。）
* 在核心域上的战术投入能否消除架构变化所带来的影响？事务脚本是做不到这一点的（和领域模型层相比，其他层更易受到架构变化的影响）。
* 客户是否的确能从这种持续设计和开发的方式中获益，或者有现成的产品就能满足他们的需求？换句话说，我们是否应该一开始就考虑定制化开发？
* 使用DDD的战术开发模式会比其他开发方式更加困难吗，比如事务脚本？（这个问题很大程度上取决于团队成员的技能水平和是否有领域专家。）
* 如果团队已经具备了实施DDD的条件，我们还会刻意地选择另一种开发方式吗？有些开发者已经将模型的持久化变得很实用了，比如使用ORM、全聚合序列化和持久化、事件存储（Event Store）、或者战术DDD框架等。但是我们也不能排除还有热衷于其他开发方式的开发者。



**DDD并不笨重**

​	在我看来，DDD绝非是充满繁文缛节的笨重开发过程。事实上，DDD能够很好地与敏捷项目框架结合起来，比如Scrum。DDD也倾向于“测试先行，逐步改进”的设计思路。在你开发一个新的领域对象时，比如实体或值对象，你可以采用以下步骤进行：

1. 编写测试代码以模拟客户代码是如何使用该领域对象的。
2. 创建该领域对象以使测试代码能够编译通过。
3. 同时对测试和领域对象进行重构，直到测试代码能够正确地模拟客户代码，同时领域对象拥有能够表明业务行为的方法签名。
4. 实现领域对象的行为，直到测试通过为止，再对实现代码进行重构。
5. 向你的团队成员展示代码，包括领域专家，以保证领域对象能够正确地反映通用语言。



​	你可能会想：“这和我之前采用的测试驱动开发没什么区别啊。”对，他们可能有细微的区别，但是基本思路是一样的。测试代码并不能保证我们的领域对象就是无懈可击的。之后，我们还会添加另外的测试代码。首先，我们关注的是客户代码如何使用领域对象，此时的测试代码驱动着模型的设计。这种方式和敏捷开发并没有多大区别。因此，即便你并不认为上面的步骤是敏捷，但它们的确表明，DDD采用的是一种“敏捷的”方式进行软件开发的。

## 虚构的案例，真实的实践

**SaaSOvation，它的产品和对DDD的使用**

​	旗舰产品名为CollabOvation，这是一套企业协作（collaboration）软件，并且加入了社交网络的功能。该产品的功能包括论坛（forum）、共享日历（sharedcalendar）、博客（blog）、即时消息（instant message）、wiki、留言板（message board）、文档管理（document management）、通知（announcement）和提醒（alert）、活动跟踪（activity tracking）和RSS等。所有的这些协作工具都旨在满足企业业务的需求，帮助他们在项目中提高工作效率。在这个经济步伐不断加快的时代里，业务协作对于企业氛围的营造起着重要的作用。任何有助于提高生产率、鼓励知识分享和增进团队协作的实践都是企业成功的促成因素。

​	CollabOvation希望给客户带来有价值的产品；而对于开发者，他们所面对的挑战也是富有意义的。

​	第二套产品名为ProjectOvation，这是该公司的开发团队主要关注的核心域。ProjectOcation主要用于敏捷项目的管理，使用Scrum作为项目管理方式，并且采用增量式的管理框架。该产品采用传统的Scrum项目管理模型，其中包括产品（product）、产品负责人（product owner）、团队（team）、待定项（backlog item）、计划发布（planned release）和冲刺（sprint）。对待定项的评估通过对业务价值的分析来确定。

​	首先启动的项目是CollabOvation。该团队中有为数不多的几个“老兵”，但大量的是些中级开发人员。在项目组的早期会议中，他们决定采用DDD。其中一个高级开发者在他上家公司中使用过非常有限的DDD。在他谈到自己DDD经验之后，我们可以看出他并没有全面地使用DDD，他使用的其实是DDD-Lite。

​	DDD-Lite是DDD战术模式的一个子集，它并不强调对通用语言的使用。此外，DDD-Lite通常也忽略了限界上下文和上下文映射图。更多的，DDD-Lite是关于技术实现层面的，虽然这也是有好处的，但是好处并没有与DDD战略模式一同使用时那么大。SaaSOvation决定采用DDD-Lite，然而不久之后他们就遇到问题了，因为他们并不了解子域和限界上下文。

​	更糟糕的是，SaaSOvation虽然避开了DDD-Lite的陷阱，但这纯属侥幸，因为他们的两套核心产品自然地形成了各自的限界上下文。这也使得CollabOvation模型和ProjectOvation模型得到了正式地分离，但是这也是偶然的，并不意味着团队就是了解限界上下文的，而这也是为什么该团队在一开始就遇到了问题的原因。不学就得落后啊。

# 2. 领域、子域和限界上下文

在本章中，你需要好好地理解以下三个概念：

* 什么是领域
* 什么是子域
* 什么是限界上下文

本章学习路线图• 理解领域、子域和限界上下文。

* 理解战略设计的重要性。
* 学习一个真实的领域，其中包含多个子域。
* 理解限界上下文。
* 看看SaaSOvation是如何开始采用战略设计的。