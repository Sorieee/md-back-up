# 1.计算机系统漫游

## 1.2 程序被其他程序翻译成不同的格式

![](https://pic.imgdb.cn/item/62c59e4e5be16ec74a89d6fe.jpg)

在Unix 系统上，从源文件到目标文件的转化是由编译器驱动程序完成的：

```sh
gcc -o hello hello.e
```

​	在这里， GCC 编译器驱动程序读取源程序文件hello.c, 并把它翻译成一个可执行目标文件hello 。这个翻译过程可分为四个阶段完成，如图1 - 3 所示。执行这四个阶段的程序（预处理器、编译器、汇编器和链接器）一起构成了编译系统(compilation system) 。

![](https://pic.imgdb.cn/item/62c59f055be16ec74a8abf72.jpg)

这样的简单操作并不多，它们围绕着主存、寄存器文件(register file) 和算术／逻辑单元(ALU) 进行。寄存器文件是一个小的存储设备，由一些单个字长的寄存器组成，每个寄存器都有唯一的名字。ALU 计算新的数据和地址值。下面是一些简单操作的例子，CPU 在指令的要求下可能会执行这些操作。

* 加载：从主存复制一个字节或者一个字到寄存器，以覆盖寄存器原来的内容。
* 存储：从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置上原来的内容。
* 操作： 把两个寄存器的内容复制到ALU, ALU 对这两个字做算术运算，并将结果存放到一个寄存器中，以覆盖该寄存器中原来的内容。
* 跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器(PC) 中，以覆盖PC 中原来的值。

## 1. 6 存储设备形成层次结构

![](https://pic.imgdb.cn/item/62c5a2785be16ec74a8f6204.jpg)

## 1.7 操作系统管理硬件

### 1. 7. 3 虚拟内存

![](https://pic.imgdb.cn/item/62c5a3335be16ec74a908502.jpg)

​	每个进程看到的虚拟地址空间由大量准确定义的区构成，每个区都有专门的功能。在本书的后续章节你将学到更多有关这些区的知识，但是先简单了解每一个区是非常有益的。我们从最低的地址开始，逐步向上介绍。

* 程序代码和数据。对所有的进程来说，代码是从同一固定地址开始，紧接着的是和C 全局变量相对应的数据位置。代码和数据区是直接按照可执行目标文件的内容初始化的，在示例中就是可执行文件hello 。在第7 章我们研究链接和加载时，你会学习更多有关地址空间的内容。
* 堆。代码和数据区后紧随着的是运行时堆。代码和数据区在进程一开始运行时就被指定了大小，与此不同，当调用像malloc 和free 这样的C 标准库函数时，堆可以在运行时动态地扩展和收缩。在第9 章学习管理虚拟内存时，我们将更详细地研究堆。
* 共享库。大约在地址空间的中间部分是一块用来存放像C 标准库和数学库这样的共
  享库的代码和数据的区域。共享库的概念非常强大，也相当难懂。在第7 章介绍动
  态链接时，将学习共享库是如何工作的。
* 栈。位于用户虚拟地址空间顶部的是用户栈，编译器用它来实现函数调用。和堆一样，用户栈在程序执行期间可以动态地扩展和收缩。特别地，每次我们调用一个函数时，栈就会增长；从一个函数返回时，栈就会收缩。在第3 章中将学习编译器是如何使用栈的。
*  内核虚拟内存。地址空间顶部的区域是为内核保留的。不允许应用程序读写这个区域的内容或者直接调用内核代码定义的函数。相反，它们必须调用内核来执行这些操作。

### 1.7.4 文件

​	文件就是字节序列，仅此而已。每个I/0 设备，包括磁盘、键盘、显示器，甚至网络，都可以看成是文件。系统中的所有输入输出都是通过使用一小组称为Unix I/0 的系统函数调用读写文件来实现的。

## 1. 8 系统之间利用网络通信

![](https://pic.imgdb.cn/item/62c5a49f5be16ec74a92d2fb.jpg)

## 1. 9 重要主题

### 1. 9 . 1 Amdahl 定律

![](https://pic.imgdb.cn/item/62c5a4c85be16ec74a9315cb.jpg)

### 1. 9. 2 并发和并行

**1 线程级并发**

构建在进程这个抽象之上，我们能够设计出同时有多个程序执行的系统，这就导致了并发。使用线程，我们甚至能够在一个进程中执行多个控制流。

![](https://pic.imgdb.cn/item/62c5a54f5be16ec74a93f262.jpg)

​	超线程，有时称为同时多线程(simultaneous multi-threading), 是一项允许一个CPU执行多个控制流的技术。它涉及CPU 某些硬件有多个备份，比如程序计数器和寄存器文件，而其他的硬件部分只有一份，比如执行浮点算术运算的单元。常规的处理器需要大约20 000 个时钟周期做不同线程间的转换，而超线程的处理器可以在单个周期的基础上决定要执行哪一个线程。这使得CPU 能够更好地利用它的处理资源。比如，假设一个线程必须等到某些数据被装载到高速缓存中，那CPU 就可以继续去执行另一个线程。举例来说，Intel Core i7 处理器可以让每个核执行两个线程，所以一个4 核的系统实际上可以并行地执行8 个线程。