# 微服务标准化

* 接口标准化
  * 减少沟通成本，提高开发和维护效率。
* 日志标准化
  * 方便后续的日志治理。
  * 日志输出的目的不仅是发现问题，好的日志可以帮助我们快速排查出问题的原因，进而采取相应的应对措施，因此日志规范需要聚焦如何更加方便快捷地追查问题，提高问题追查的效率。
* 透传通道标准化
  * 治理相关的信息在请求处理的整个链路中透传，服务治理聚焦的都是非功能需求，这些需求业务服务其实是不需要关注的，因此需要有一定的机制来减少服务治理的非功能特性对业务的侵入，最大程度上实现业务透明的服务治理接入。

# 持续集成与发布

* 研发全流程平台
  * 微服务研发全流程包括很多环节，比如代码分支管理、代码review、测试准入、提测、自动化测试、服务部署、服务变更等，每个环节都有相应的工作流，研发工作流平台将研发全流程中的工作流串在一起，形成一个完整的闭环。
* 灰度发布
  * 微服务化在架构层面是一个非常大的改动，为了不影响线上业务的稳定性，需要采用灰度发布的方式，每一次发布均需要先进行小范围灰度，观察完全没有问题之后再放量发布。
  * 灰度发布的维度可以根据业务的特点而定，常见的灰度维度有按照机器、按照流量百分比、按照城市或者人群等。

# **微服务拆分**

**拆分原则**

​	微服务拆分前，需要确定拆分的基本原则，微服务拆分的一个非常重要原则是无状态，无状态服务方便扩展和运维，所以无状态设计需要贯穿到微服务架构设计的全局层面进行思考。

​	服务拆分粒度并不是越细越好，需要结合当前团队的人员情况而定，比如当前团队只有5个人，如果拆分后的微服务个数超过50，和人员的数量严重不匹配，不仅不会带来效率的提升，反而会导致效率的下降，建议拆分后每个人维护的微服务不要超过3个，并且每个微服务都有相应的备用负责人，规避可能的突发风险；针对多团队异地开发的情况，最好拆分后每个子团队负责的微服务相对独立，尽量减少异地团队的直接沟通成本。

**拆分方法**

* 以数据为维度进行拆分
  * 以电商系统为例，大体可分为订单系统、用户系统、库存系统等。以订单系统为例，订单系统就负责订单核心数据的维护、订单数据的增删查改，确立了主要实体数据后可以根据数据的查询、修改等确定服务的接口，如订单的各种查询接口以及订单状态更新接口。
* 按照使用场景拆分服务
  * 按照使用场景进行服务拆分，这种拆分方式也比较常见，如顺风车的所有后端查询操作之前都在一个单体服务里面，有固定路线/临时路线查询顺路订单，有根据路线查询附近订单，还有查询跨城订单，以及后续的需求乘客查询附近司机，乘客查询顺路司机等。之前这些在线查询接口都在一个单体服务中，多个RD会同时负责和修改这个服务的代码，开发效率低下，测试、上线都会相互影响，维护起来比较困难，后来把这些查询按照功能都拆分为不同的子服务，每个RD单独负责，大大提高了开发、测试以及运维效率。
* 重要和非重要的拆分
* 变和不变的拆分
  * 按照变更频次对服务进行拆分，尽量将变化聚集到少部分微服务上面，系统的绝大多数服务变更很少，可以减少变更对整个系统的冲击和影响。

# 微服务通信

**微服务通信方式选择**

​	微服务通信时，首先需要考虑的是通信方式的选择，对一些不需要返回业务数据的微服务来说，究竟是采用同步方式还是异步方式呢？同步方式架构层面要求比较高，异步方式架构层面比较优雅，但运维成本比较高，出现问题时排查起来不太方便。之前公司中有过一次不成功的架构升级实例，业务形态完全围绕订单状态流转进行，当前的架构初衷是构建一套基于事件驱动的基础设施，所有微服务均以事件驱动的方式进行触发，最后不仅对业务人员的挑战比较大，同时运维、高可用和问题追查的成本比较高。因此微服务化时，核心服务推荐均采用同步通信的方式，一些非核心服务可以采用异步通信的方式。

**微服务编排**

​	微服务编排上，一些可以并行调用的场景推荐采用并行调用的方式，可以减少请求的整体耗时，提高用户体验。

**API接口设计**

​	API接口设计上，需要尽可能简单易用，一个接口只实现一个确定的功能，不要设计复杂或者含义不明确的接口，避免滥用；同时接口设计时做好前后向兼容，以及幂等性设计。

**合理设置超时和重试**

​	